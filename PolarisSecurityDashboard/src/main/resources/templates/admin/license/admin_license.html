<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin_layout}">

<head>
  <meta charset="UTF-8" />
  <title>License Manage</title>
  <link rel="stylesheet" th:href="@{/css/admin_license.css}">
  <script defer th:src="@{/js/admin_license.js}"></script>
</head>

<body>
<div layout:fragment="content" class="license-page">

  <!-- ✅ Breadcrumb -->
  <div class="breadcrumb">
    <span class="path">
      <a th:href="@{/admin/customers}" th:text="${customerName} ?: '관리자'">관리자</a>
      <span>/</span>
      <strong>라이선스 관리</strong>
    </span>
  </div>

  <!-- ✅ 검색 필터 영역 -->
  <section class="search-bar">
    <input type="text" id="searchInput" placeholder="서비스명 / 고객사명 / 요청자명 검색">
    <select id="sdkFilter">
      <option value="">SDK 유형 (전체)</option>
      <option value="SecuOne">SecuOne SDK</option>
      <option value="RB_iOS">RB버전_iOS 포함</option>
      <option value="SDK3">SDK 3.0</option>
    </select>
    <select id="typeFilter">
      <option value="">요청 구분 (전체)</option>
      <option value="issue">발급 요청</option>
      <option value="update">수정 요청</option>
      <option value="notIssued">미발급</option>
      <option value="expiring">만료 D-30</option>
    </select>
    <button id="searchBtn">조회</button>
  </section>

  <!-- ✅ 발급 요청란 -->
  <section class="panel" data-type="issue">
    <div class="panel-header">
      <h3>발급 요청란</h3>
      <button class="arrow-btn">›</button>
    </div>

    <div class="panel-body">
      <table>
        <thead>
        <tr>
          <th>서비스명</th>
          <th>고객사명</th>
          <th>요청자명</th>
          <th>요청일자</th>
          <th>승인</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="req : ${issueRequests}">
          <td th:text="${req.service.serviceName}">서비스명</td>
          <td th:text="${req.service.customer.customerName}">고객사명</td>
          <td th:text="${req.requesterEmail}">요청자명</td>
          <td th:text="${#temporals.format(req.requestedAt, 'yyyy-MM-dd HH:mm')}">2025-09-23</td>
          <td>
            <form th:action="@{'/admin/license/approve/' + ${req.id}}" method="post">
              <button type="submit" class="btn-green">승인</button>
            </form>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(issueRequests)}">
          <td colspan="5" style="text-align:center; color:#888;">현재 발급 요청이 없습니다.</td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- ✅ 수정 요청란 (옵션 섹션) -->
  <section class="panel" data-type="update">
    <div class="panel-header">
      <h3>수정 요청란</h3>
      <button class="arrow-btn">›</button>
    </div>
    <div class="panel-body">
      <table>
        <thead>
        <tr>
          <th>서비스명</th>
          <th>고객사명</th>
          <th>요청자명</th>
          <th>요청사항</th>
          <th>요청일자</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td colspan="5" style="text-align:center; color:#94a3b8;">현재 수정 요청이 없습니다.</td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- ✅ 미발급 & 만료 D-30 -->
  <section class="panel grid-2">
    <!-- 미발급 서비스 -->
    <div class="panel-item" data-type="notIssued">
      <div class="panel-header">
        <h3>미발급 서비스</h3>
        <button class="arrow-btn">›</button>
      </div>
      <div class="panel-body">
        <table>
          <thead>
          <tr>
            <th>서비스명</th>
            <th>고객사명</th>
            <th>담당자명</th>
            <th>생성일자</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="service : ${services}">
            <td>
              <a th:href="@{/admin/customers/{customerId}/services/{serviceId}(customerId=${service.customerId}, serviceId=${service.serviceId})}"
                 th:text="${service.serviceName}">서비스명</a>
            </td>
            <td th:text="${service.customerName}">고객사명</td>
            <td th:text="${service.contactName}">담당자명</td>
            <td th:text="${service.createAt != null ? service.createAt : 'N/A'}">생성일자</td>
          </tr>
          <tr th:if="${#lists.isEmpty(services)}">
            <td colspan="4" style="text-align:center; color:#94a3b8;">미발급 서비스가 없습니다.</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 만료 D-30 -->
    <div class="panel-item" data-type="expiring">
      <div class="panel-header">
        <h3>만료 D-30</h3>
        <button class="arrow-btn">›</button>
      </div>
      <div class="panel-body">
        <table>
          <thead>
          <tr>
            <th>서비스명</th>
            <th>고객사명</th>
            <th>마지막 변경일</th>
            <th>만료일</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="svc : ${expiringServices}">
            <td th:text="${svc.serviceName}">서비스명</td>
            <td th:text="${svc.customer.customerName}">고객사명</td>
            <td th:text="${#temporals.format(svc.updateAt, 'yyyy-MM-dd')}">2025-04-12</td>
            <td th:text="${#temporals.format(svc.license.expireDate, 'yyyy-MM-dd')}">2025-09-22</td>
          </tr>
          <tr th:if="${#lists.isEmpty(expiringServices)}">
            <td colspan="4" style="text-align:center; color:#94a3b8;">만료 예정 서비스가 없습니다.</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>
</div>
</body>
</html>
