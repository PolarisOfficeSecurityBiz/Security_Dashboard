<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin_layout}">
<head>
  <meta charset="UTF-8"/>
  <title>로그 관리</title>
  <!-- 부모 레이아웃이 head를 컨트롤하므로 여기 링크는 생략 -->
</head>
<body>
  <!-- ✅ 레이아웃의 layout:fragment="content" 를 채움 -->
  <div layout:fragment="content">

    <!-- ✅ 페이지 전용 CSS를 head에 '확실히' 삽입 (부모 CSS 이후 로드) -->
    <script>
      (function injectLogsCss(){
        var href = '/css/logs.css?v=10';
        if(!document.querySelector('link[data-page-style="logs"]')){
          var l = document.createElement('link');
          l.rel = 'stylesheet';
          l.href = href;
          l.setAttribute('data-page-style','logs');
          document.head.appendChild(l);
        }
      })();
    </script>

    <!-- (선택) 즉시 전환용 최소 인라인 보정 -->
    <style>
      .admin-body, .admin-main { background:#f7f9fc !important; }
      .panel{ background:#fff !important; }
    </style>

    <header class="topbar">
      <h1>Security Logs Dashboard</h1>
    </header>

    <main class="container">
      <!-- Filters -->
      <section class="panel filters">
        <div class="row">
          <label>
            기간
            <select id="range">
              <option value="7" selected>최근 7일</option>
              <option value="1">오늘</option>
              <option value="14">최근 14일</option>
              <option value="30">최근 30일</option>
            </select>
          </label>

          <label>
            LogType
            <select id="type">
              <option value="ALL" selected>전체</option>
              <option value="MALWARE">MALWARE</option>
              <option value="REMOTE">REMOTE</option>
              <option value="ROOTING">ROOTING</option>
            </select>
          </label>

          <label class="grow">
            고객사(도메인)
            <input id="domain" type="text" placeholder="예: corp.example.com" />
          </label>

          <button id="refresh" class="btn primary">적용</button>
        </div>
      </section>

      <!-- KPI Cards -->
      <section class="kpis">
        <div class="kpi">
          <div class="kpi-label">총 로그</div>
          <div class="kpi-value" id="kpi-total">0</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">MALWARE</div>
          <div class="kpi-value" id="kpi-malware">0</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">REMOTE</div>
          <div class="kpi-value" id="kpi-remote">0</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">ROOTING</div>
          <div class="kpi-value" id="kpi-rooting">0</div>
        </div>
      </section>

      <!-- Grouped Summaries -->
      <section class="grid-2">
		<div class="panel">
		  <h3>날짜별(최근 7일)</h3>
		  <!-- 인라인 크기 강제 (CSS 미적용 대비) -->
		  <div class="chart-wrap" style="width:100%;height:260px">
		    <canvas id="by-day-chart" style="width:100%;height:100%;display:block"></canvas>
		  </div>
		</div>

        <div class="panel">
          <h3>고객사(도메인)별</h3>
          <div id="by-domain" class="list"></div>
        </div>
      </section>

      <!-- Table -->
      <section class="panel">
        <div class="table-header">
          <h3>로그 목록</h3>
          <div class="right muted" id="result-info"></div>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Created At</th>
                <th>Domain</th>
                <th>Type</th>
                <th>OS</th>
                <th>App</th>
                <th>Extra</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>

        <div class="pager">
          <button id="prev" class="btn">이전</button>
          <span id="page-info" class="muted">1 / 1</span>
          <button id="next" class="btn">다음</button>
        </div>
      </section>
    </main>

    <footer class="foot muted">
      Asia/Seoul 기준 · 클라이언트 집계(백엔드 응답 스키마: id, domain, logType, createdAt, osVersion, appVersion, extra)
    </footer>

    <!-- ✅ 페이지 전용 JS (부모 후순위 로드 보장) -->
    <script defer src="/js/logs.js?v=10"></script>
    <script>
      // 방어적으로 CSS 주입 재확인
      (function ensureCss(){
        if(!document.querySelector('link[data-page-style="logs"]')){
          var l=document.createElement('link'); l.rel='stylesheet'; l.href='/css/logs.css?v=10'; l.setAttribute('data-page-style','logs');
          document.head.appendChild(l);
        }
      })();
    </script>

  </div>
</body>
</html>
