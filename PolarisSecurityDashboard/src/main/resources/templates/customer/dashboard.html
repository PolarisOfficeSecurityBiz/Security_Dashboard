<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/customer_layout}">
<head>
  <meta charset="UTF-8">
  <title>ê³ ê°ì‚¬ ëŒ€ì‹œë³´ë“œ</title>
  <link rel="stylesheet" th:href="@{/css/customer_overview.css}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<!-- âœ… ë„¤ë¹„ê²Œì´ì…˜ ì‚½ì… -->
<div th:replace="fragments/customer_nav :: nav"></div>

<main class="overview-container" layout:fragment="content">

  <header class="dashboard-header">
    <h1>ê³ ê°ì‚¬ ëŒ€ì‹œë³´ë“œ</h1>
    <p th:text="'í™˜ì˜í•©ë‹ˆë‹¤, ' + ${#authentication.principal.username} + 'ë‹˜ ğŸ‘‹'"></p>
  </header>

  <!-- ìƒë‹¨ í†µê³„ ì¹´ë“œ -->
  <section class="top-stats">
    <div class="stat-card">
      <h4>ì´ë²ˆë‹¬ ìœ ì… ìœ ì € ìˆ˜</h4>
      <div class="stat-value">2,040</div>
      <div class="stat-change">+10.3%</div>
    </div>
    <div class="stat-card">
      <h4>ì´ë²ˆë‹¬ ì •ì‚° í˜„í™©</h4>
      <div class="stat-value">1,203</div>
      <div class="stat-change">+10.3%</div>
    </div>
    <div class="stat-card">
      <h4>í™œì„± ë¼ì´ì„ ìŠ¤ ìˆ˜</h4>
      <div class="stat-value">10</div>
      <div class="stat-change">+10.3%</div>
    </div>
  </section>

  <!-- ë¼ì´ì„ ìŠ¤ ìƒíƒœ -->
  <section class="license-status">
    <h3>ë¼ì´ì„ ìŠ¤ ìƒíƒœ</h3>
    <table>
      <thead>
      <tr>
        <th>ì„œë¹„ìŠ¤ ëª…</th>
        <th>ë§Œë£Œì¼</th>
        <th>D-Day</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="license : ${licenses}">
        <td th:text="${license.name}">ì´ì§€ë¡œê·¸</td>
        <td th:text="${license.expireDate}">2025.09.24</td>
        <td th:text="${license.dDay}">D-20</td>
      </tr>
      <tr th:if="${#lists.isEmpty(licenses)}">
        <td colspan="3" style="text-align:center; color:#94a3b8;">ë“±ë¡ëœ ë¼ì´ì„ ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
      </tr>
      </tbody>
    </table>
  </section>

  <!-- ì›”ë³„ ìœ ì € ìœ ì… í˜„í™© -->
  <section class="chart-section">
    <h3>ì›”ë³„ ìœ ì € ìœ ì… í˜„í™©</h3>
    <canvas id="userChart"></canvas>
  </section>

  <!-- ì˜¬í•´ ì •ì‚° í˜„í™© -->
  <section class="settlement-status">
    <h3>ì˜¬í•´ ì •ì‚° í˜„í™©</h3>
    <table>
      <thead>
      <tr>
        <th>ì›”ë³„</th>
        <th>ì •ì‚° ê¸ˆì•¡</th>
        <th>ì •ì‚° íŒŒì¼</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="settlement : ${settlements}">
        <td th:text="${settlement.month + 'ì›”'}">1ì›”</td>
        <td th:text="${#numbers.formatInteger(settlement.amount, 3, 'COMMA') + 'ì›'}">â‚© 210,900.00</td>
        <td>
          <a th:href="@{/files/{id}(id=${settlement.fileId})}" target="_blank">
            <i class="fa fa-file-download"></i>
          </a>
        </td>
      </tr>
      <tr th:if="${#lists.isEmpty(settlements)}">
        <td colspan="3" style="text-align:center; color:#94a3b8;">ì •ì‚° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
      </tr>
      </tbody>
    </table>
  </section>
</main>

<script>
  // Chart.js: ìœ ì… í˜„í™©
  document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('userChart');
    if (!ctx) return;
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”'],
        datasets: [
          {
            label: 'ì‹ ê·œ ìœ ì…',
            data: [30, 40, 55, 60, 35, 50],
            backgroundColor: 'rgba(108, 122, 255, 0.7)'
          },
          {
            label: 'ì¬ë°©ë¬¸',
            data: [15, 25, 35, 30, 25, 40],
            backgroundColor: 'rgba(225, 165, 255, 0.7)'
          }
        ]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } },
        scales: { y: { beginAtZero: true } }
      }
    });
  });
</script>
</body>
</html>
