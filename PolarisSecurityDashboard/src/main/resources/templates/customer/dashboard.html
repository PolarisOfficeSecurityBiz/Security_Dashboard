<!-- src/main/resources/templates/customer/overview.html -->
<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/customer_layout}">
<head>
  <meta charset="UTF-8">
  <title>고객사 대시보드</title>

  <!-- 페이지 전용 스타일 -->
  <link rel="stylesheet" th:href="@{/css/customer_overview.css}"/>

  <!-- 차트 (필요 페이지에서만 로드) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>

<body>
  <!-- ✅ 레이아웃이 사이드바/메인 구조를 렌더링하므로,
       여기서는 content 조각만 넘겨줍니다. -->
  <main class="overview-container" layout:fragment="content">

    <header class="dashboard-header">
      <h1>고객사 대시보드</h1>
    </header>

    <!-- 상단 통계 카드 -->
    <section class="top-stats">
      <div class="stat-card">
        <h4>이번달 유입 유저 수</h4>
        <div class="stat-value">2,040</div>
        <div class="stat-change">+10.3%</div>
      </div>
      <div class="stat-card">
        <h4>이번달 정산 현황</h4>
        <div class="stat-value">1,203</div>
        <div class="stat-change">+10.3%</div>
      </div>
      <div class="stat-card">
        <h4>활성 라이선스 수</h4>
        <div class="stat-value">10</div>
        <div class="stat-change">+10.3%</div>
      </div>
    </section>

    <!-- 라이선스 상태 -->
    <section class="license-status">
      <h3>라이선스 상태</h3>
      <table>
        <thead>
        <tr>
          <th>서비스 명</th>
          <th>만료일</th>
          <th>D-Day</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="license : ${licenses}">
          <td th:text="${license.name}">이지로그</td>
          <td th:text="${license.expireDate}">2025.09.24</td>
          <td th:text="${license.dDay}">D-20</td>
        </tr>
        <tr th:if="${#lists.isEmpty(licenses)}">
          <td colspan="3" style="text-align:center; color:#94a3b8;">등록된 라이선스가 없습니다.</td>
        </tr>
        </tbody>
      </table>
    </section>

    <!-- 월별 유저 유입 현황 -->
    <section class="chart-section">
      <h3>월별 유저 유입 현황</h3>
      <canvas id="userChart" width="400" height="200"></canvas>
    </section>

    <!-- 올해 정산 현황 -->
    <section class="settlement-status">
      <h3>올해 정산 현황</h3>
      <table>
        <thead>
        <tr>
          <th>월별</th>
          <th>정산 금액</th>
          <th>정산 파일</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="settlement : ${settlements}">
          <td th:text="${settlement.month + '월'}">1월</td>
          <td th:text="${#numbers.formatInteger(settlement.amount, 3, 'COMMA') + '원'}">210,900원</td>
          <td>
            <a th:href="@{/files/{id}(id=${settlement.fileId})}" target="_blank" aria-label="정산 파일 다운로드">
              <i class="fa-solid fa-file-arrow-down"></i>
            </a>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(settlements)}">
          <td colspan="3" style="text-align:center; color:#94a3b8;">정산 내역이 없습니다.</td>
        </tr>
        </tbody>
      </table>
    </section>

    <!-- 페이지 전용 스크립트 -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const el = document.getElementById('userChart');
        if (!el || !window.Chart) return;

        new Chart(el, {
          type: 'bar',
          data: {
            labels: ['1월', '2월', '3월', '4월', '5월', '6월'],
            datasets: [
              {
                label: '신규 유입',
                data: [30, 40, 55, 60, 35, 50],
                backgroundColor: 'rgba(108, 122, 255, 0.7)'
              },
              {
                label: '재방문',
                data: [15, 25, 35, 30, 25, 40],
                backgroundColor: 'rgba(225, 165, 255, 0.7)'
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } },
            scales: { y: { beginAtZero: true } }
          }
        });
      });
    </script>
  </main>
</body>
</html>
