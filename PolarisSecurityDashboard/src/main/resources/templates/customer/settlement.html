<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/customer_layout}">

<head layout:fragment="head">
  <meta charset="UTF-8" />
  <title>일별 정산 내역</title>
  <link rel="stylesheet" th:href="@{/css/settlement.css}" />
</head>

<body>
<div layout:fragment="content" class="layout">
  <main class="content">

    <div class="breadcrumb">Dashboards / 일별 정산 내역</div>

    <div class="card">
      <!-- ✅ 상단 탭 네비게이션 -->
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="daily">유입/이탈 현황</button>
        <button class="tab-btn" data-tab="partner">제휴사 정산 내역</button>
      </div>

      <!-- ✅ 유입/이탈 현황 -->
      <section id="daily" class="tab-content active">
        <h2 th:text="${month.monthValue} + '월 ' + ${daily.day} + '일 유입/이탈/유지 현황'"></h2>

        <table class="data-table">
          <thead>
            <tr>
              <th>구분</th>
              <th>유입</th>
              <th>이탈</th>
              <th>유지</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>전체 사용자</td>
              <td th:text="${daily.join} + '명'"></td>
              <td th:text="${daily.leave} + '명'"></td>
              <td th:text="${daily.retain} + '명'"></td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- ✅ 제휴사 정산 내역 -->
      <section id="partner" class="tab-content">
        <h2 th:text="${month.monthValue} + '월 제휴사 정산 내역 (1일 ~ ' + ${month.lengthOfMonth()} + '일)'"></h2>

        <table class="data-table">
          <thead>
            <tr>
              <th>구분</th>
              <th>유입 수</th>
              <th>CPI (원)</th>
              <th>유지 수</th>
              <th>RS Rate</th>
              <th>기간(일)</th>
              <th>정산 금액</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="p : ${partners}">
              <td th:text="${p.partnerName}"></td>
              <td th:text="${p.joinCount}"></td>
              <td th:text="'₩' + ${#numbers.formatInteger(p.cpi, 3, 'COMMA')}"></td>
              <td th:text="${p.retainCount}"></td>
              <td th:text="'₩' + ${#numbers.formatInteger(p.rsRate, 3, 'COMMA')}"></td>
              <td th:text="${p.days}"></td>
              <!-- ✅ JS로 계산 -->
              <td class="calc"
                  th:attr="data-cpi=${p.cpi}, data-rs=${p.rsRate}, data-join=${p.joinCount}, data-retain=${p.retainCount}, data-days=${p.days}">
                  ₩0
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>

  </main>
</div>

<!-- ✅ 스크립트 -->
<script th:src="@{/js/settlement.js}"></script>
</body>
</html>
